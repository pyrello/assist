webpackJsonp([30,3,47,81,82],{"/7L0":function(t,e,s){var n=s("VU/8")(s("BJ4r"),s("Wsdi"),!1,null,null,null);t.exports=n.exports},"06Lg":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){var n=s("woOf"),i=s.n(n),a=s("OQde");e.default={name:"selectize",data:function(){return{fetched:!0,localConfig:this.defaultConfig(),updating:!1,allCount:0,allCached:"",previousValue:null}},props:{all:{type:Array|Object},clear:{type:Boolean,default:!1},config:Object,disabled:{default:!1,type:Boolean},id:String,multiple:{default:!1,type:Boolean},labelField:{default:"name",type:String},placeholder:{default:"Select the item...",type:String},template:String,value:Array|String,identity:String,valueField:{default:"value",type:String},valueType:{default:"string",type:String}},computed:{selectize:function(){return this.$el&&this.$el.selectize||null}},mounted:function(){i()(this.localConfig,this.config),this.init()},updated:function(){i()(this.localConfig,this.config),this.init()},destroyed:function(){this.$el.selectize.destroy()},watch:{all:function(){var t=this;this.updating=!0,this.selectize&&(this.selectize.disable(),this.clearOptions(),this.selectize.load(function(e){t.all.length>0?(t.selectize.enable(),e(t.all),t.selectize.setValue(t.value,!0)):e(),t.updating=!1}))},disabled:function(t){this.selectize&&(t?this.selectize.disable():this.selectize.enable())},clear:function(t){t&&this.clearOptions(),this.$emit("clear")},value:function(t){this.previousValue=t,t||this.clearOptions(),this.selectize&&this.selectize.setValue(t,!0)}},methods:{defaultConfig:function(){var t=this,e=this;return{valueField:this.valueField,labelField:this.labelField,searchField:this.labelField,onInitialize:function(){t.setValue()},onChange:function(e){t.select(e)},render:{option:function(t,s){return'<div class="option">'+s(e.itemLabel(t))+"</div>"},item:function(t,s){return'<div class="item">'+s(e.itemLabel(t))+"</div>"}}}},clearOptions:function(){this.selectize&&(this.selectize.loadedSearches={},this.selectize.userOptions={},this.selectize.renderCache={},this.selectize.options=this.selectize.sifter.items={},this.selectize.lastQuery=null,this.selectize.trigger("option_clear"),this.selectize.clear(!0))},init:function(){this.selectEl=this.$refs.select,t(this.$el).selectize(this.localConfig),this.setValue()},itemLabel:function(t){return Object(a.f)(this.template)?(t.first_name&&!Object(a.f)(t.first_name)&&t.last_name&&!Object(a.f)(t.last_name)&&console.warn("first name and last name are undefined",t),Object(a.k)(this.template,t)):"string"==typeof t?t:t[this.labelField]},itemValue:function(t){return"string"==typeof t?t:Object(a.i)(t,this.valueField)?t[this.valueField]:t.id},select:function(t){"number"===this.valueType&&0!==t&&"0"!==t&&(t=Array.isArray(t)?t.map(function(t){return Number(t)}):Number(t)),this.$emit("input",t)},setValue:function(){this.$el.selectize.setValue(this.value,!0)}}}}.call(e,s("7t+N"))},"1LT8":function(t,e,s){var n=s("VU/8")(s("2KWr"),s("8og9"),!1,null,null,null);t.exports=n.exports},"2KWr":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){var n=s("Dd8w"),i=s.n(n),a=s("M4fF"),l=(s.n(a),s("71cn")),r=s.n(l);e.default={components:{DemographicOptions:r.a},data:function(){return{activeRange:0,includeAll:!0,include:[],subs:{},labels:{},showModal:!1,showOptionsIndex:-1}},methods:{allowSplit:function(t){return null!==t.min&&null!==t.max},blankRange:function(){return{min:null}},deleteRange:function(t){var e=this.ranges[t];this.ranges.splice(t,1),this.$set(this.ranges[t],"min",e.min)},rangeName:function(t){var e="";return null===t.min?"":(e+=t.min.toString(),t.hasOwnProperty("max")&&null!==t.max?e+=" - "+t.max.toString():e+="+",e)},setLabel:function(t,e){this.list.splice(t,1,this.initObject(this.list[t],e))},setNextRangeMin:function(t,e){this.$set(this.ranges[t+1],"min",Number(e)+1)},showSplitOptions:function(t){this.showOptionsIndex=t,this.showModal=!0},splitRange:function(e){var s=this,n=this.ranges[e],a=i()({},this.blankRange(),{max:null}),l=this.blankRange();a.min=n.min,n.hasOwnProperty("max")&&null!==n.max&&(l.max=n.max),this.ranges.splice(e,1,a),this.ranges.splice(e+1,0,l),this.$nextTick(function(){s.activeRange=e,t(s.$refs["range-max-"+e]).focus()})},toggleAll:function(){this.includeAll?this.$set(this,"include",this.services.map(function(t){return t.name})):this.$set(this,"include",[])},toggleInclude:function(t){console.log("toggling include"),"string"==typeof this.list[t]&&this.list.splice(t,1,this.initObject(this.list[t],"",!1))},convertToObject:function(t){"string"==typeof this.list[t]?this.list.splice(t,1,this.initObject(this.list[t])):console.error("Attempted to convert an object into an object")},initObject:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return console.log("creating object",t,e,s),{name:t,label:e,include:s}}},props:{label:{type:String,default:"Range"},type:String,list:Array},watch:{}}}.call(e,s("7t+N"))},"71cn":function(t,e,s){var n=s("VU/8")(s("r/2Y"),s("oUie"),!1,null,null,null);t.exports=n.exports},"8og9":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"form-group"},[t.label?s("label",{staticClass:"control-label",domProps:{textContent:t._s(t.label)}}):t._e(),t._v(" "),s("table",{staticClass:"table table-striped no-bottom-margin"},[s("thead",[s("tr",[s("th",{staticClass:"fit-content"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.includeAll,expression:"includeAll"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.includeAll)?t._i(t.includeAll,null)>-1:t.includeAll},on:{change:[function(e){var s=t.includeAll,n=e.target,i=!!n.checked;if(Array.isArray(s)){var a=t._i(s,null);n.checked?a<0&&(t.includeAll=s.concat([null])):a>-1&&(t.includeAll=s.slice(0,a).concat(s.slice(a+1)))}else t.includeAll=i},t.toggleAll]}})]),t._v(" "),s("th",[t._v("Label")]),t._v(" "),s("th",[t._v("Options")])])]),t._v(" "),s("tbody",[t._l(t.list,function(e,n){return["string"==typeof e?[s("tr",[s("td",{staticClass:"fit-content"},[s("input",{attrs:{type:"checkbox",id:"victim_types-include-"+e,checked:"checked"},on:{click:function(e){t.toggleInclude(n)}}})]),t._v(" "),s("td",{staticClass:"td-input"},[s("input",{staticClass:"form-control input-sm",attrs:{type:"text",placeholder:e},on:{input:function(e){t.setLabel(n,e.target.value)}}})]),t._v(" "),s("td",[s("a",{staticClass:"btn btn-rounded btn-primary btn-xs",attrs:{href:"#split-range"},on:{click:function(e){e.stopPropagation(),t.showSplitOptions(n)}}},[s("i",{staticClass:"fa fa-chevron-left"})])])])]:[s("tr",[s("td",{staticClass:"fit-content"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.list[n].include,expression:"list[index].include"}],attrs:{type:"checkbox",id:"victim_types-include-"+e},domProps:{value:e,checked:Array.isArray(t.list[n].include)?t._i(t.list[n].include,e)>-1:t.list[n].include},on:{change:function(s){var i=t.list[n].include,a=s.target,l=!!a.checked;if(Array.isArray(i)){var r=e,o=t._i(i,r);a.checked?o<0&&t.$set(t.list[n],"include",i.concat([r])):o>-1&&t.$set(t.list[n],"include",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.list[n],"include",l)}}})]),t._v(" "),s("td",{staticClass:"td-input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.label,expression:"item.label"}],staticClass:"form-control input-sm",attrs:{type:"text",placeholder:e.name,disabled:!e.include},domProps:{value:e.label},on:{input:function(s){s.target.composing||t.$set(e,"label",s.target.value)}}})]),t._v(" "),s("td",[s("a",{staticClass:"btn btn-rounded btn-primary btn-xs",attrs:{href:"#split-range"},on:{click:function(e){e.stopPropagation(),t.showSplitOptions(n)}}},[s("i",{staticClass:"fa fa-chevron-left"})])])])]]})],2)]),t._v(" "),s("modal",{attrs:{show:t.showModal},on:{"update:show":function(e){t.showModal=e}}},[t.showOptionsIndex>=0?[s("header",[s("h1",[t._v("Select demographic to sub-divide by")])]),t._v(" "),s("form",{attrs:{role:"form"},on:{submit:function(e){return e.preventDefault(),t.add(e)}}},[s("demographic-options",{attrs:{label:"Base demographic set",exclude:[t.type]}})],1)]:t._e()],2),t._v(" "),t._m(0)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("small",{staticClass:"help-block"},[this._v("Use the insert button ("),e("i",{staticClass:"fa fa-chevron-left"}),this._v(") to break a range into multiple ranges. Use the delete button ("),e("i",{staticClass:"fa fa-times"}),this._v(") to remove a range. Use the label box to create an different label for the range.")])}]}},BJ4r:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){var n=s("Dd8w"),i=s.n(n),a=s("NYxO"),l=s("PJh5"),r=s.n(l),o=s("sDUr"),c=s.n(o),u=s("qvTH"),d=s.n(u),h=s("1LT8"),p=s.n(h),f=s("71cn"),m=s.n(f);e.default={computed:i()({},Object(a.c)("profiles",{profiles:"all"})),components:{DemographicOptions:m.a,ListWidget:p.a,SelectAgeRanges:c.a,SelectEthnicity:d.a},data:function(){var t=r()().format("YYYY-MM-DD");return{model:{report_profile_id:0,start_date:r()().subtract(1,"year").format("YYYY-MM-DD"),end_date:t},controls:{dates:"This month"}}},created:function(){this.controls.dates="Last quarter",this.setDates(this.controls.dates),this.fetchProfiles()},methods:i()({},Object(a.b)("profiles",{fetchProfiles:"fetch"}),Object(a.b)("reports",["create"]),{process:function(){var t=this,e={data:this.model};this.create(e).then(function(e){t.addMessage("Report created successfully"),t.$router.push("/reporting/reports/"+e.id)}).catch(function(e){t.addMessage({text:e.message,type:"danger"})})},setDates:function(t){var e=this.getDatesFromLabel(t),s=e.start_date,n=e.end_date;this.model.start_date=s,this.model.end_date=n},getDatesFromLabel:function(t){var e=r()(),s=r()();switch(t){case"This month":e=e.startOf("month");break;case"This quarter":e=e.startOf("quarter");break;case"This year":e=e.startOf("year");break;case"Last month":e=e.subtract(1,"month").startOf("month"),s=s.subtract(1,"month").endOf("month");break;case"Last quarter":e=e.subtract(1,"quarter").startOf("quarter"),s=s.subtract(1,"quarter").endOf("quarter");break;case"Last year":e=e.subtract(1,"year").startOf("year"),s=s.subtract(1,"year").endOf("year")}return{start_date:e=e.format("YYYY-MM-DD"),end_date:s=s.format("YYYY-MM-DD")}},setNextRangeMin:function(t,e,s){this.$set(t[e+1],"min",Number(s)+1)},showSplitOptions:function(t,e){this.controls.split.modal.show=!0},splitByAges:function(t,e,s){if(Object.prototype.hasOwnProperty.call(this.report.query,t))if(Object.prototype.hasOwnProperty.call(this.report.query[t].ages,e)||this.$set(this.report.query[t].ages,e,[]),void 0===s){this.report.query[t].ages[e].splice(0,1,{min:0})}else{var n=this.report.query[t].ages[e][s],a=i()({},this.blankRange(),{max:null}),l=this.blankRange();a.min=n.min,n.hasOwnProperty("max")&&null!==n.max&&(l.max=n.max),this.report.query[t].ages[e].splice(s,1,a),this.report.query[t].ages[e].splice(s+1,0,l)}},splitRange:function(e){var s=this,n=this.ranges[e],a=i()({},this.blankRange(),{max:null}),l=this.blankRange();a.min=n.min,n.hasOwnProperty("max")&&null!==n.max&&(l.max=n.max),this.ranges.splice(e,1,a),this.ranges.splice(e+1,0,l),this.$nextTick(function(){s.activeRange=e,t(s.$refs["range-max-"+e]).focus()})},toggleAllEthnicity:function(){this.controls.ethnicity.include_all?this.$set(this.report.query.ethnicity,"include",this.ethnicity.map(function(t){return t.name})):this.$set(this.report.query.ethnicity,"include",[])},toggleAllServices:function(){this.controls.services.include_all?this.$set(this.report.query.services,"include",this.services.map(function(t){return t.name})):this.$set(this.report.query.services,"include",[])},toggleAllVictimTypes:function(){this.controls.services.include_all?this.$set(this.report.query.services,"include",this.services.map(function(t){return t.name})):this.$set(this.report.query.services,"include",[])}})}}.call(e,s("7t+N"))},EUaC:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("select",{ref:"select",staticClass:"form-control",attrs:{id:t.id,placeholder:t.placeholder,multiple:t.multiple},domProps:{value:t.value},on:{"update:value":function(e){t.value=e}}},[t._t("default",t._l(t.all,function(e){return s("option",{domProps:{value:t.itemValue(e),textContent:t._s(t.itemLabel(e))}})}))],2)},staticRenderFns:[]}},Wsdi:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"overlay-background"},[s("div",{staticClass:"overlay"},[s("header",{staticClass:"overlay-header"},[s("div",{staticClass:"header-actions pull-right"},[s("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:function(e){e.stopPropagation(),t.$router.back()}}},[s("i",{staticClass:"fa fa-close"}),t._v(" "),s("span",{staticClass:"hidden-xs"},[t._v("Cancel")])])]),t._v(" "),s("h1",[t._v("Add Report")])]),t._v(" "),s("div",{staticClass:"section"},[s("form",{attrs:{role:"form"},on:{submit:function(e){return e.preventDefault(),t.process(e)}}},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"control-label"},[t._v("Dates")]),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.controls.dates,expression:"controls.dates"}],staticClass:"form-control",on:{change:[function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.controls,"dates",e.target.multiple?s:s[0])},function(e){t.setDates(e.target.value)}]}},[s("option",[t._v("This month")]),t._v(" "),s("option",[t._v("This quarter")]),t._v(" "),s("option",[t._v("This year")]),t._v(" "),s("option",[t._v("Last month")]),t._v(" "),s("option",[t._v("Last quarter")]),t._v(" "),s("option",[t._v("Last year")]),t._v(" "),s("option",[t._v("Custom...")])])]),t._v(" "),"Custom..."===t.controls.dates?s("div",{staticClass:"well"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-sm-6"},[s("input-date",{attrs:{label:"Start Date",id:"start_date"},model:{value:t.model.start_date,callback:function(e){t.$set(t.model,"start_date",e)},expression:"model.start_date"}})],1),t._v(" "),s("div",{staticClass:"col-sm-6"},[s("input-date",{attrs:{label:"End Date",id:"end_date"},model:{value:t.model.end_date,callback:function(e){t.$set(t.model,"end_date",e)},expression:"model.end_date"}})],1)])]):t._e(),t._v(" "),s("div",{staticClass:"form-group"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.model.report_profile_id,expression:"model.report_profile_id"}],staticClass:"form-control",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.model,"report_profile_id",e.target.multiple?s:s[0])}}},[s("option",{attrs:{value:"0",selected:""}},[t._v("Select a report profile...")]),t._v(" "),t._l(t.profiles,function(e){return s("option",{domProps:{value:e.id}},[t._v(t._s(e.label))])})],2)]),t._v(" "),s("button",{staticClass:"btn btn-primary btn-lg",attrs:{type:"submit"}},[t._v("Create")]),t._v(" "),s("a",{staticClass:"btn btn-link",on:{click:function(e){e.stopPropagation(),t.$router.back()}}},[t._v("Cancel")])])])])])},staticRenderFns:[]}},YTeY:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){var n=s("Dd8w"),i=s.n(n),a=s("M4fF");s.n(a);e.default={data:function(){return{activeRange:0}},methods:{allowSplit:function(t){return null!==t.min&&null!==t.max},blankRange:function(){return{min:null}},deleteRange:function(t){var e=this.ranges[t];this.ranges.splice(t,1),this.$set(this.ranges[t],"min",e.min)},rangeName:function(t){var e="";return null===t.min?"":(e+=t.min.toString(),t.hasOwnProperty("max")&&null!==t.max?e+=" - "+t.max.toString():e+="+",e)},setLabel:function(t,e){this.$set(this.ranges[t],"label",e)},setNextRangeMin:function(t,e){this.$set(this.ranges[t+1],"min",Number(e)+1)},splitRange:function(e){var s=this,n=this.ranges[e],a=i()({},this.blankRange(),{max:null}),l=this.blankRange();a.min=n.min,n.hasOwnProperty("max")&&null!==n.max&&(l.max=n.max),this.ranges.splice(e,1,a),this.ranges.splice(e+1,0,l),this.$nextTick(function(){s.activeRange=e,t(s.$refs["range-max-"+e]).focus()})}},props:{label:{type:String,default:"Range"},ranges:Array},watch:{ranges:function(){this.$emit("update:ranges",this.ranges)}}}}.call(e,s("7t+N"))},oUie:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("selectize",{attrs:{all:t.allExceptExcluded,selected:t.selected,label:t.label},on:{"update:selected":[function(e){t.selected=e},t.select]}})},staticRenderFns:[]}},qvTH:function(t,e,s){var n=s("VU/8")(s("06Lg"),s("EUaC"),!1,null,null,null);t.exports=n.exports},"r/2Y":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={computed:{allExceptExcluded:function(){var t=this;return this.options.filter(function(e){return t.exclude.indexOf(e.value)<0})}},data:function(){return{options:[{name:"Age",value:"age"},{name:"Ethnicity",value:"ethnicity"},{name:"Gender",value:"gender"},{name:"Services Provided",value:"services"},{name:"Victim Types",value:"victimTypes",nameField:"description"}]}},methods:{select:function(t){void 0===t&&(t=this.selected),this.$emit("update:selected",t)}},props:{exclude:{type:Array,default:function(){return[]}},label:String,selected:Array|String}}},sDUr:function(t,e,s){var n=s("VU/8")(s("YTeY"),s("tgRN"),!1,null,null,null);t.exports=n.exports},tgRN:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"form-group"},[s("label",{staticClass:"control-label",domProps:{textContent:t._s(t.label)}}),t._v(" "),s("table",{staticClass:"table"},[t._m(0),t._v(" "),s("tbody",t._l(t.ranges,function(e,n){return s("tr",[s("td",{staticClass:"col-sm-1 text-right"},[t._v(t._s(e.min))]),t._v(" "),e.hasOwnProperty("max")?s("td",{staticClass:"fit-content"},[t._v("-")]):s("td",{staticClass:"fit-content"},[t._v("+")]),t._v(" "),s("td",{staticClass:"fit-content td-number td-input"},[e.hasOwnProperty("max")?s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.ranges[n].max,expression:"ranges[index].max",modifiers:{number:!0}}],ref:"range-max-"+n,refInFor:!0,staticClass:"form-control input-sm col-sm-1",attrs:{type:"number",size:"4",min:e.min+1},domProps:{value:t.ranges[n].max},on:{keyup:function(e){t.setNextRangeMin(n,e.target.value)},input:function(e){e.target.composing||t.$set(t.ranges[n],"max",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}}):t._e()]),t._v(" "),t.allowSplit(e)?s("td",{staticClass:"td-btn"},[t.allowSplit(e)?s("a",{staticClass:"btn btn-rounded btn-primary btn-xs",attrs:{href:"#split-range"},on:{click:function(e){e.stopPropagation(),t.splitRange(n)}}},[s("i",{staticClass:"fa fa-chevron-left"})]):t._e(),t._v(" "),t.allowSplit(e)&&n<t.ranges.length-1?s("a",{staticClass:"btn btn-rounded btn-danger btn-xs",attrs:{href:"#delete-range"},on:{click:function(e){e.stopPropagation(),t.deleteRange(n)}}},[s("i",{staticClass:"fa fa-times"})]):t._e()]):t.activeRange==n?s("td",[s("small",{staticClass:"help-block"},[t._v("Enter the top of the range")])]):t.activeRange+1==n?s("td",[s("small",{staticClass:"help-block"},[t._v("This will update automatically")])]):s("td"),t._v(" "),s("td",{staticClass:"td-input"},[t.allowSplit(e)?s("input",{staticClass:"form-control input-sm",attrs:{type:"text",placeholder:t.rangeName(e)},domProps:{value:t.ranges[n].label},on:{input:function(e){t.setLabel(n,e.target.value)}}}):t._e()])])}))]),t._v(" "),t._m(1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",[e("th",{staticClass:"col-sm-1"},[this._v("Min")]),this._v(" "),e("th",{staticClass:"fit-content"}),this._v(" "),e("th",{staticClass:"fit-content"},[this._v("Max")]),this._v(" "),e("th"),this._v(" "),e("th",[this._v("Label")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("small",{staticClass:"help-block"},[this._v("Use the insert button ("),e("i",{staticClass:"fa fa-chevron-left"}),this._v(") to break a range into multiple ranges. Use the delete button ("),e("i",{staticClass:"fa fa-times"}),this._v(") to remove a range. Use the label box to create an different label for the range.")])}]}}});